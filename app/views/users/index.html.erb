<% content_for :title, "Users Management" %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="h3 mb-0">
    <i class="fas fa-users me-2"></i>
    Users Management
  </h1>
  <div class="text-muted">
    Total: <%= @users.count %> users
  </div>
</div>

<div class="card shadow-sm">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th scope="col">#</th>
            <th scope="col">Name</th>
            <th scope="col">Email</th>
            <th scope="col">Role</th>
            <th scope="col">Status</th>
            <th scope="col">Created At</th>
            <th scope="col" class="text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% if @users.any? %>
            <% @users.each_with_index do |user, index| %>
              <tr>
                <td><%= index + 1 %></td>
                <td>
                  <div class="d-flex align-items-center">
                    <div class="avatar-sm me-2">
                      <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center text-white" style="width: 32px; height: 32px;">
                        <%= user.name&.first&.upcase || user.email.first.upcase %>
                      </div>
                    </div>
                    <div>
                      <%= user.name.present? ? user.name : 'N/A' %>
                    </div>
                  </div>
                </td>
                <td><%= user.email %></td>
                <td>
                  <% case user.role %>
                  <% when 'admin' %>
                    <span class="badge bg-danger">
                      <i class="fas fa-crown me-1"></i>Admin
                    </span>
                  <% when 'seller' %>
                    <span class="badge bg-warning">
                      <i class="fas fa-store me-1"></i>Seller
                    </span>
                  <% when 'buyer' %>
                    <span class="badge bg-info">
                      <i class="fas fa-shopping-cart me-1"></i>Buyer
                    </span>
                  <% end %>
                </td>
                <td>
                  <% case user.status %>
                  <% when 'active' %>
                    <span class="badge bg-success">
                      <i class="fas fa-check-circle me-1"></i>Active
                    </span>
                  <% when 'blocked' %>
                    <span class="badge bg-danger">
                      <i class="fas fa-ban me-1"></i>Blocked
                    </span>
                  <% when 'pending_approval' %>
                    <span class="badge bg-warning">
                      <i class="fas fa-clock me-1"></i>Pending
                    </span>
                  <% when 'inactive' %>
                    <span class="badge bg-secondary">
                      <i class="fas fa-pause me-1"></i>Inactive
                    </span>
                  <% end %>
                </td>
                <td>
                  <small class="text-muted">
                    <%= user.created_at.strftime("%d/%m/%Y") %>
                  </small>
                </td>
                <td class="text-center">
                  <div class="btn-group" role="group">
                    <%= link_to user_path(user), class: "btn btn-sm btn-outline-primary", title: "View Details" do %>
                      <i class="fas fa-eye"></i>
                    <% end %>
                    
                    <% if user.status == 'pending_approval' %>
                      <%= link_to approve_user_path(user),
                          class: "btn btn-sm btn-outline-success", 
                          title: "Approve User",
                          data: { turbo_method: :patch, turbo_confirm: "Are you sure you want to approve this user?" } do %>
                        <i class="fas fa-check"></i>
                      <% end %>
                      
                      <%= link_to refuse_user_path(user),
                          class: "btn btn-sm btn-outline-danger", 
                          title: "Refuse User",
                          data: { turbo_method: :patch, turbo_confirm: "Are you sure you want to refuse this user?" } do %>
                        <i class="fas fa-times"></i>
                      <% end %>
                    <% end %>
                  </div>
                </td>
              </tr>
            <% end %>
          <% else %>
            <tr>
              <td colspan="7" class="text-center py-5">
                <div class="text-muted">
                  <i class="fas fa-users fa-3x mb-3"></i>
                  <p class="mb-0">No users found</p>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
      <div class="d-flex justify-content-center mt-4">
        <%= paginate @users %>
      </div>
    </div>
  </div>
</div>

<style>
  .avatar-sm {
    flex-shrink: 0;
  }
  
  .table > :not(caption) > * > * {
    padding: 1rem 0.75rem;
  }
  
  .btn-group .btn {
    margin-right: 2px;
  }
  
  .btn-group .btn:last-child {
    margin-right: 0;
  }
</style>