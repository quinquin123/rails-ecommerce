<!-- 
  Thông thường trong Rails, create action sẽ redirect hoặc render :new
  File này chỉ cần thiết nếu bạn muốn có một view riêng cho create action
  Trong hầu hết trường hợp, bạn chỉ cần sử dụng new.html.erb
-->

<div class="row justify-content-center">
  <div class="col-lg-8 col-md-10">
    <!-- Success Message -->
    <% if @product&.persisted? %>
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle me-2"></i>
        <strong>Success!</strong> Product "<%= @product.name %>" has been created successfully.
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
      
      <div class="card shadow-sm">
        <div class="card-header bg-success text-white">
          <h3 class="card-title mb-0">
            <i class="fas fa-check-circle me-2"></i>
            Product Created Successfully
          </h3>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4">
              <% if @product.image.attached? %>
                <%= image_tag @product.image, class: "img-fluid rounded", style: "max-height: 200px; width: 100%; object-fit: cover;" %>
              <% else %>
                <div class="bg-light border rounded d-flex align-items-center justify-content-center" style="height: 200px;">
                  <i class="fas fa-image fa-3x text-muted"></i>
                </div>
              <% end %>
            </div>
            <div class="col-md-8">
              <h4 class="text-primary"><%= @product.name %></h4>
              <p><span class="badge bg-secondary"><%= @product.category&.humanize %></span></p>
              <h3 class="text-success">$<%= @product.price %></h3>
              <p class="text-muted"><%= @product.description %></p>
              <div class="product-details">
                <small class="text-muted">
                  <% if @product.brand.present? %>
                    <strong>Brand:</strong> <%= @product.brand %> |
                  <% end %>
                  <% if @product.condition.present? %>
                    <strong>Condition:</strong> <%= @product.condition.humanize %> |
                  <% end %>
                  <strong>Available:</strong> <%= @product.quantity %> items
                </small>
              </div>
            </div>
          </div>
          
          <hr class="my-4">
          
          <div class="d-flex justify-content-between align-items-center">
            <div class="d-flex gap-2">
              <%= link_to products_path, class: "btn btn-outline-primary" do %>
                <i class="fas fa-list me-2"></i>
                View All Products
              <% end %>
              
              <%= link_to new_product_path, class: "btn btn-outline-success" do %>
                <i class="fas fa-plus me-2"></i>
                Add Another Product
              <% end %>
            </div>
            
            <div class="d-flex gap-2">
              <%= link_to edit_product_path(@product), class: "btn btn-warning" do %>
                <i class="fas fa-edit me-2"></i>
                Edit Product
              <% end %>
              
              <%= link_to product_path(@product), class: "btn btn-primary" do %>
                <i class="fas fa-eye me-2"></i>
                View Product
              <% end %>
            </div>
          </div>
        </div>
      </div>
      
    <% else %>
      <!-- Error handling - render the form again with errors -->
      <div class="card shadow-sm">
        <div class="card-header bg-danger text-white">
          <h3 class="card-title mb-0">
            <i class="fas fa-exclamation-triangle me-2"></i>
            Failed to Create Product
          </h3>
        </div>
        <div class="card-body">
          <% if @product&.errors&.any? %>
            <div class="alert alert-danger" role="alert">
              <h5><i class="fas fa-exclamation-triangle me-2"></i>Please fix the following errors:</h5>
              <ul class="mb-0">
                <% @product.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <!-- Re-render the form with errors -->
          <%= form_with(model: @product, local: true, html: { multipart: true, class: "needs-validation", novalidate: true }) do |form| %>
            <div class="row">
              <div class="col-md-6 mb-3">
                <%= form.label :name, class: "form-label fw-semibold" %>
                <%= form.text_field :name, class: "form-control #{'is-invalid' if @product.errors[:name].any?}", placeholder: "Enter product name", required: true %>
                <% if @product.errors[:name].any? %>
                  <div class="invalid-feedback">
                    <%= @product.errors[:name].first %>
                  </div>
                <% end %>
              </div>

              <div class="col-md-6 mb-3">
                <%= form.label :category, class: "form-label fw-semibold" %>
                <%= form.select :category, 
                    options_for_select([
                      ['Electronics', 'electronics'],
                      ['Clothing', 'clothing'],
                      ['Books', 'books'],
                      ['Home & Garden', 'home_garden'],
                      ['Sports', 'sports'],
                      ['Beauty', 'beauty'],
                      ['Toys', 'toys'],
                      ['Other', 'other']
                    ], @product.category), 
                    { prompt: 'Select a category' }, 
                    { class: "form-select #{'is-invalid' if @product.errors[:category].any?}", required: true } %>
                <% if @product.errors[:category].any? %>
                  <div class="invalid-feedback">
                    <%= @product.errors[:category].first %>
                  </div>
                <% end %>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <%= form.label :price, class: "form-label fw-semibold" %>
                <div class="input-group">
                  <span class="input-group-text">$</span>
                  <%= form.number_field :price, step: 0.01, min: 0, class: "form-control #{'is-invalid' if @product.errors[:price].any?}", placeholder: "0.00", required: true %>
                  <% if @product.errors[:price].any? %>
                    <div class="invalid-feedback">
                      <%= @product.errors[:price].first %>
                    </div>
                  <% end %>
                </div>
              </div>

              <div class="col-md-6 mb-3">
                <%= form.label :quantity, class: "form-label fw-semibold" %>
                <%= form.number_field :quantity, min: 0, class: "form-control #{'is-invalid' if @product.errors[:quantity].any?}", placeholder: "Available quantity", required: true %>
                <% if @product.errors[:quantity].any? %>
                  <div class="invalid-feedback">
                    <%= @product.errors[:quantity].first %>
                  </div>
                <% end %>
              </div>
            </div>

            <div class="mb-3">
              <%= form.label :description, class: "form-label fw-semibold" %>
              <%= form.text_area :description, rows: 4, class: "form-control #{'is-invalid' if @product.errors[:description].any?}", placeholder: "Describe your product in detail..." %>
              <% if @product.errors[:description].any? %>
                <div class="invalid-feedback">
                  <%= @product.errors[:description].first %>
                </div>
              <% end %>
            </div>

            <div class="mb-3">
              <%= form.label :image, "Product Image", class: "form-label fw-semibold" %>
              <%= form.file_field :image, class: "form-control #{'is-invalid' if @product.errors[:image].any?}", accept: "image/*" %>
              <% if @product.errors[:image].any? %>
                <div class="invalid-feedback">
                  <%= @product.errors[:image].first %>
                </div>
              <% end %>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <%= form.label :brand, class: "form-label fw-semibold" %>
                <%= form.text_field :brand, class: "form-control #{'is-invalid' if @product.errors[:brand].any?}", placeholder: "Product brand" %>
                <% if @product.errors[:brand].any? %>
                  <div class="invalid-feedback">
                    <%= @product.errors[:brand].first %>
                  </div>
                <% end %>
              </div>

              <div class="col-md-6">
                <%= form.label :condition, class: "form-label fw-semibold" %>
                <%= form.select :condition, 
                    options_for_select([
                      ['New', 'new'],
                      ['Like New', 'like_new'],
                      ['Good', 'good'],
                      ['Fair', 'fair'],
                      ['Poor', 'poor']
                    ], @product.condition), 
                    { prompt: 'Select condition' }, 
                    { class: "form-select #{'is-invalid' if @product.errors[:condition].any?}" } %>
                <% if @product.errors[:condition].any? %>
                  <div class="invalid-feedback">
                    <%= @product.errors[:condition].first %>
                  </div>
                <% end %>
              </div>
            </div>

            <hr class="my-4">

            <div class="d-flex justify-content-between align-items-center">
              <div>
                <%= link_to products_path, class: "btn btn-secondary" do %>
                  <i class="fas fa-arrow-left me-2"></i>
                  Back to Products
                <% end %>
              </div>

              <div class="d-flex gap-2">
                <%= form.button type: "submit", name: "draft", class: "btn btn-outline-primary" do %>
                  <i class="fas fa-save me-2"></i>
                  Save as Draft
                <% end %>
                
                <%= form.submit "Create Product", class: "btn btn-primary" do %>
                  <i class="fas fa-plus me-2"></i>
                  Create Product
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<style>
  .card {
    border: none;
    border-radius: 12px;
  }
  
  .card-header {
    border-radius: 12px 12px 0 0 !important;
    border-bottom: 1px solid #dee2e6;
  }
  
  .form-control:focus,
  .form-select:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
  }
  
  .btn {
    border-radius: 8px;
    font-weight: 500;
  }
  
  .form-label {
    color: #495057;
    margin-bottom: 0.5rem;
  }
  
  .product-details {
    margin-top: 1rem;
  }
</style>